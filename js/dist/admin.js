/*! For license information please see admin.js.LICENSE.txt */
(()=>{var t={24(t,e,n){var a=n(163),o=n(110),r=n(996),s=n(312),i=n(166),l=n(766),u=n(760);function d(){"use strict";var e=o(),n=e.m(d),c=(Object.getPrototypeOf?Object.getPrototypeOf(n):n.__proto__).constructor;function m(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===c||"GeneratorFunction"===(e.displayName||e.name))}var h={throw:1,return:2,break:3,continue:3};function p(t){var e,n;return function(a){e||(e={stop:function(){return n(a.a,2)},catch:function(){return a.v},abrupt:function(t,e){return n(a.a,h[t],e)},delegateYield:function(t,o,r){return e.resultName=o,n(a.d,u(t),r)},finish:function(t){return n(a.f,t)}},n=function(t,n,o){a.p=e.prev,a.n=e.next;try{return t(n,o)}finally{e.next=a.n}}),e.resultName&&(e[e.resultName]=a.v,e.resultName=void 0),e.sent=a.v,e.next=a.n;try{return t.call(this,e)}finally{a.p=e.prev,a.n=e.next}}}return(t.exports=d=function(){return{wrap:function(t,n,a,o){return e.w(p(t),n,a,o&&o.reverse())},isGeneratorFunction:m,mark:e.m,awrap:function(t,e){return new a(t,e)},AsyncIterator:i,async:function(t,e,n,a,o){return(m(e)?s:r)(p(t),e,n,a,o)},keys:l,values:u}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=d,t.exports.__esModule=!0,t.exports.default=t.exports},110(t,e,n){var a=n(397);function o(){var e,n,r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function l(t,o,r,s){var i=o&&o.prototype instanceof d?o:d,l=Object.create(i.prototype);return a(l,"_invoke",function(t,a,o){var r,s,i,l=0,d=o||[],c=!1,m={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return r=t,s=0,i=e,m.n=n,u}};function h(t,a){for(s=t,i=a,n=0;!c&&l&&!o&&n<d.length;n++){var o,r=d[n],h=m.p,p=r[2];t>3?(o=p===a)&&(i=r[(s=r[4])?5:(s=3,3)],r[4]=r[5]=e):r[0]<=h&&((o=t<2&&h<r[1])?(s=0,m.v=a,m.n=r[1]):h<p&&(o=t<3||r[0]>a||a>p)&&(r[4]=t,r[5]=a,m.n=p,s=0))}if(o||t>1)return u;throw c=!0,a}return function(o,d,p){if(l>1)throw TypeError("Generator is already running");for(c&&1===d&&h(d,p),s=d,i=p;(n=s<2?e:i)||!c;){r||(s?s<3?(s>1&&(m.n=-1),h(s,i)):m.n=i:m.v=i);try{if(l=2,r){if(s||(o="next"),n=r[o]){if(!(n=n.call(r,i)))throw TypeError("iterator result is not an object");if(!n.done)return n;i=n.value,s<2&&(s=0)}else 1===s&&(n=r.return)&&n.call(r),s<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),s=1);r=e}else if((n=(c=m.n<0)?i:t.call(a,m))!==u)break}catch(t){r=e,s=1,i=t}finally{l=1}}return{value:n,done:c}}}(t,r,s),!0),l}var u={};function d(){}function c(){}function m(){}n=Object.getPrototypeOf;var h=[][s]?n(n([][s]())):(a(n={},s,function(){return this}),n),p=m.prototype=d.prototype=Object.create(h);function g(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,a(t,i,"GeneratorFunction")),t.prototype=Object.create(p),t}return c.prototype=m,a(p,"constructor",m),a(m,"constructor",c),c.displayName="GeneratorFunction",a(m,i,"GeneratorFunction"),a(p),a(p,i,"Generator"),a(p,s,function(){return this}),a(p,"toString",function(){return"[object Generator]"}),(t.exports=o=function(){return{w:l,m:g}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},163(t){t.exports=function(t,e){this.v=t,this.k=e},t.exports.__esModule=!0,t.exports.default=t.exports},166(t,e,n){var a=n(163),o=n(397);t.exports=function t(e,n){function r(t,o,s,i){try{var l=e[t](o),u=l.value;return u instanceof a?n.resolve(u.v).then(function(t){r("next",t,s,i)},function(t){r("throw",t,s,i)}):n.resolve(u).then(function(t){l.value=t,s(l)},function(t){return r("throw",t,s,i)})}catch(t){i(t)}}var s;this.next||(o(t.prototype),o(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),o(this,"_invoke",function(t,e,a){function o(){return new n(function(e,n){r(t,a,e,n)})}return s=s?s.then(o,o):o()},!0)},t.exports.__esModule=!0,t.exports.default=t.exports},183(t,e,n){var a=n(24)();t.exports=a;try{regeneratorRuntime=a}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=a:Function("r","regeneratorRuntime = r")(a)}},312(t,e,n){var a=n(110),o=n(166);t.exports=function(t,e,n,r,s){return new o(a().w(t,e,n,r),s||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},397(t){function e(n,a,o,r){var s=Object.defineProperty;try{s({},"",{})}catch(n){s=0}t.exports=e=function(t,n,a,o){function r(n,a){e(t,n,function(t){return this._invoke(n,a,t)})}n?s?s(t,n,{value:a,enumerable:!o,configurable:!o,writable:!o}):t[n]=a:(r("next",0),r("throw",1),r("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,e(n,a,o,r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},735(t){function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},760(t,e,n){var a=n(735).default;t.exports=function(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(a(t)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},766(t){t.exports=function(t){var e=Object(t),n=[];for(var a in e)n.unshift(a);return function t(){for(;n.length;)if((a=n.pop())in e)return t.value=a,t.done=!1,t;return t.done=!0,t}},t.exports.__esModule=!0,t.exports.default=t.exports},996(t,e,n){var a=n(312);t.exports=function(t,e,n,o,r){var s=a(t,e,n,o,r);return s.next().then(function(t){return t.done?t.value:s.next()})},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function n(a){var o=e[a];if(void 0!==o)return o.exports;var r=e[a]={exports:{}};return t[a](r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var a in e)n.o(e,a)&&!n.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=flarum.core.compat["admin/app"];var e=n.n(t);function a(t,e){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},a(t,e)}function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,a(t,e)}const r=flarum.core.compat["common/Model"];var s=n.n(r),i=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))||this).name=s().attribute("name"),e.url=s().attribute("url"),e.secret=s().attribute("secret"),e.hasSecret=s().attribute("hasSecret"),e.events=s().attribute("events"),e.groupId=s().attribute("groupId"),e.tagId=s().attribute("tagId"),e.extraText=s().attribute("extraText"),e.maxPostContentLength=s().attribute("maxPostContentLength"),e.usePlainText=s().attribute("usePlainText"),e.includeTags=s().attribute("includeTags"),e.messageTemplate=s().attribute("messageTemplate"),e.error=s().attribute("error"),e.isValid=s().attribute("isValid"),e}return o(e,t),e}(s());function l(t,e,n,a,o,r,s){try{var i=t[r](s),l=i.value}catch(t){return void n(t)}i.done?e(l):Promise.resolve(l).then(a,o)}function u(t){return function(){var e=this,n=arguments;return new Promise(function(a,o){var r=t.apply(e,n);function s(t){l(r,a,o,s,i,"next",t)}function i(t){l(r,a,o,s,i,"throw",t)}s(void 0)})}}var d=n(183),c=n.n(d);const h=flarum.core.compat["admin/components/ExtensionPage"];var p=n.n(h);const g=flarum.core.compat["common/components/Button"];var b=n.n(g);const k=flarum.core.compat["common/components/LoadingIndicator"];var v=n.n(k);const f=flarum.core.compat["common/Component"];var w=n.n(f);const x=flarum.core.compat["common/helpers/icon"];var y=n.n(x),_=function(t){function n(){return t.apply(this,arguments)||this}o(n,t);var a=n.prototype;return a.view=function(){var t=this.attrs,n=t.webhook,a=t.onEdit,o=t.onDelete,r=t.onTest,s=n.events()||[],i=s.length,l=!!n.error(),u=n.isValid();return m("div",{className:"WebhookCard "+(l?"WebhookCard--error":"")+" "+(u?"":"WebhookCard--invalid")},m("div",{className:"WebhookCard-header"},m("div",{className:"WebhookCard-title"},y()("fas fa-bell"),m("span",{className:"WebhookCard-name"},n.name()||e().translator.trans("dingtalk-webhook.admin.nav.title"))),m("div",{className:"WebhookCard-actions"},m(b(),{className:"Button Button--icon",icon:"fas fa-paper-plane",onclick:r,title:e().translator.trans("dingtalk-webhook.admin.settings.card.test_button")}),m(b(),{className:"Button Button--icon",icon:"fas fa-edit",onclick:a,title:e().translator.trans("dingtalk-webhook.admin.settings.card.edit_button")}),m(b(),{className:"Button Button--icon Button--danger",icon:"fas fa-trash",onclick:o,title:e().translator.trans("dingtalk-webhook.admin.settings.card.delete_button")}))),m("div",{className:"WebhookCard-body"},m("div",{className:"WebhookCard-info"},m("div",{className:"WebhookCard-url"},y()("fas fa-link"),m("span",{className:"WebhookCard-url-text",title:n.url()},this.truncateUrl(n.url()))),n.hasSecret()&&m("div",{className:"WebhookCard-secret"},y()("fas fa-key"),m("span",null,e().translator.trans("dingtalk-webhook.admin.settings.modal.secret_label"),": ******"))),m("div",{className:"WebhookCard-events"},i>0?m("div",{className:"WebhookCard-events-badges"},this.renderEventBadges(s)):m("div",{className:"WebhookCard-events-empty"},y()("fas fa-exclamation-triangle"),m("span",null,e().translator.trans("dingtalk-webhook.admin.settings.card.no_events")))),l&&m("div",{className:"WebhookCard-error"},y()("fas fa-exclamation-circle"),m("span",null,n.error()))),m("div",{className:"WebhookCard-footer"},m("div",{className:"WebhookCard-meta"},m("span",{className:"WebhookCard-event-count"},e().translator.trans("dingtalk-webhook.admin.settings.card.events_enabled",{count:i})),n.maxPostContentLength()>0&&m("span",{className:"WebhookCard-content-length"},y()("fas fa-text-width"),n.maxPostContentLength()," å­—"))))},a.truncateUrl=function(t){return t?t.length<=60?t:t.substring(0,50)+"..."+t.substring(t.length-10):""},a.renderEventBadges=function(t){var e=this.getEventLabels(),n=t.slice(0,4),a=t.length-4;return m("[",null,n.map(function(t){return m("span",{className:"WebhookCard-event-badge",key:t},e[t]||t)}),a>0&&m("span",{className:"WebhookCard-event-badge WebhookCard-event-badge--more"},"+",a))},a.getEventLabels=function(){return{"Flarum\\Discussion\\Event\\Started":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.discussion.started"),"Flarum\\Discussion\\Event\\Renamed":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.discussion.renamed"),"Flarum\\Discussion\\Event\\Hidden":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.discussion.hidden"),"Flarum\\Discussion\\Event\\Restored":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.discussion.restored"),"Flarum\\Discussion\\Event\\Deleted":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.discussion.deleted"),"Flarum\\Post\\Event\\Posted":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.post.posted"),"Flarum\\Post\\Event\\Revised":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.post.revised"),"Flarum\\Post\\Event\\Hidden":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.post.hidden"),"Flarum\\Post\\Event\\Restored":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.post.restored"),"Flarum\\Post\\Event\\Deleted":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.post.deleted"),"Flarum\\User\\Event\\Registered":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.user.registered"),"Flarum\\User\\Event\\Renamed":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.user.renamed"),"Flarum\\User\\Event\\Deleted":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.user.deleted"),"Flarum\\Group\\Event\\Created":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.group.created"),"Flarum\\Group\\Event\\Renamed":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.group.renamed"),"Flarum\\Group\\Event\\Deleted":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.group.deleted"),"Flarum\\Approval\\Event\\PostWasApproved":e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.approval.postwasapproved")}},n}(w());const N=flarum.core.compat["common/components/Modal"];var T=n.n(N);const F=flarum.core.compat["common/components/Switch"];var W=n.n(F);const P=flarum.core.compat["common/utils/Stream"];var E=n.n(P),C=function(t){function n(){for(var e,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))||this).name=void 0,e.url=void 0,e.secret=void 0,e.events=void 0,e.groupId=void 0,e.extraText=void 0,e.maxPostContentLength=void 0,e.usePlainText=void 0,e.includeTags=void 0,e.messageTemplate=void 0,e.activeTab=void 0,e.saving=!1,e}o(n,t);var a=n.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e);var n=this.attrs.webhook;this.name=E()((null==n?void 0:n.name())||""),this.url=E()((null==n?void 0:n.url())||""),this.secret=E()(""),this.events=E()((null==n?void 0:n.events())||[]),this.groupId=E()((null==n?void 0:n.groupId())||2),this.extraText=E()((null==n?void 0:n.extraText())||""),this.maxPostContentLength=E()((null==n?void 0:n.maxPostContentLength())||200),this.usePlainText=E()((null==n?void 0:n.usePlainText())||!1),this.includeTags=E()((null==n?void 0:n.includeTags())||!1),this.messageTemplate=E()((null==n?void 0:n.messageTemplate())||""),this.activeTab=E()("basic")},a.className=function(){return"WebhookSettingsModal Modal--large"},a.title=function(){return e().translator.trans("dingtalk-webhook.admin.settings.modal.title")},a.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"WebhookSettingsModal-tabs"},m("button",{className:"WebhookSettingsModal-tab "+("basic"===this.activeTab()?"active":""),onclick:function(){return t.activeTab("basic")}},e().translator.trans("dingtalk-webhook.admin.settings.modal.tabs.basic")),m("button",{className:"WebhookSettingsModal-tab "+("events"===this.activeTab()?"active":""),onclick:function(){return t.activeTab("events")}},e().translator.trans("dingtalk-webhook.admin.settings.modal.tabs.events")),m("button",{className:"WebhookSettingsModal-tab "+("advanced"===this.activeTab()?"active":""),onclick:function(){return t.activeTab("advanced")}},e().translator.trans("dingtalk-webhook.admin.settings.modal.tabs.advanced"))),m("div",{className:"WebhookSettingsModal-content"},"basic"===this.activeTab()&&this.renderBasicTab(),"events"===this.activeTab()&&this.renderEventsTab(),"advanced"===this.activeTab()&&this.renderAdvancedTab()),m("div",{className:"WebhookSettingsModal-actions"},m(b(),{className:"Button Button--primary",loading:this.saving,onclick:function(){return t.save()}},e().translator.trans("dingtalk-webhook.admin.settings.modal.save_button")),m(b(),{className:"Button",onclick:function(){return t.hide()}},e().translator.trans("dingtalk-webhook.admin.settings.modal.cancel_button"))))},a.renderBasicTab=function(){var t=this;return m("div",{className:"WebhookSettingsModal-tab-content"},m("div",{className:"Form-group"},m("label",null,e().translator.trans("dingtalk-webhook.admin.settings.modal.name_label")),m("input",{className:"FormControl",type:"text",bidi:this.name,placeholder:e().translator.trans("dingtalk-webhook.admin.settings.modal.name_label")}),m("p",{className:"helpText"},e().translator.trans("dingtalk-webhook.admin.settings.modal.name_help"))),m("div",{className:"Form-group"},m("label",null,e().translator.trans("dingtalk-webhook.admin.settings.modal.url_label")),m("input",{className:"FormControl",type:"text",bidi:this.url,placeholder:e().translator.trans("dingtalk-webhook.admin.settings.modal.url_placeholder")}),m("p",{className:"helpText"},e().translator.trans("dingtalk-webhook.admin.settings.modal.url_help"))),m("div",{className:"Form-group"},m("label",null,e().translator.trans("dingtalk-webhook.admin.settings.modal.secret_label")),m("input",{className:"FormControl",type:"password",bidi:this.secret,placeholder:e().translator.trans("dingtalk-webhook.admin.settings.modal.secret_placeholder")}),m("p",{className:"helpText"},e().translator.trans("dingtalk-webhook.admin.settings.modal.secret_help"))),m("div",{className:"Form-group"},m("label",null,e().translator.trans("dingtalk-webhook.admin.settings.modal.group_label")),m("select",{className:"FormControl",value:this.groupId(),onchange:function(e){return t.groupId(parseInt(e.target.value))}},this.getGroups().map(function(t){return m("option",{value:t.id,key:t.id},t.name)})),m("p",{className:"helpText"},e().translator.trans("dingtalk-webhook.admin.settings.modal.group_help"))))},a.renderEventsTab=function(){var t=this,e=this.getEventGroups();return m("div",{className:"WebhookSettingsModal-tab-content WebhookSettingsModal-events"},e.map(function(e){return m("div",{className:"WebhookSettingsModal-event-group",key:e.title},m("h4",null,e.title),m("div",{className:"WebhookSettingsModal-event-list"},e.events.map(function(e){return m(W(),{key:e.key,state:t.events().includes(e.key),onchange:function(n){return t.toggleEvent(e.key,n)}},e.label)})))}))},a.renderAdvancedTab=function(){var t=this;return m("div",{className:"WebhookSettingsModal-tab-content"},m("div",{className:"Form-group"},m(W(),{state:this.usePlainText(),onchange:function(e){return t.usePlainText(e)}},e().translator.trans("dingtalk-webhook.admin.settings.modal.use_plain_text_label")),m("p",{className:"helpText"},e().translator.trans("dingtalk-webhook.admin.settings.modal.use_plain_text_help"))),m("div",{className:"Form-group"},m("label",null,e().translator.trans("dingtalk-webhook.admin.settings.modal.max_post_content_length_label")),m("input",{className:"FormControl",type:"number",min:"0",bidi:this.maxPostContentLength}),m("p",{className:"helpText"},e().translator.trans("dingtalk-webhook.admin.settings.modal.max_post_content_length_help"))),m("div",{className:"Form-group"},m("label",null,e().translator.trans("dingtalk-webhook.admin.settings.modal.extra_text_label")),m("textarea",{className:"FormControl",rows:3,bidi:this.extraText}),m("p",{className:"helpText"},e().translator.trans("dingtalk-webhook.admin.settings.modal.extra_text_help"))),m("div",{className:"Form-group"},m(W(),{state:this.includeTags(),onchange:function(e){return t.includeTags(e)}},e().translator.trans("dingtalk-webhook.admin.settings.modal.include_matching_tags_label")),m("p",{className:"helpText"},e().translator.trans("dingtalk-webhook.admin.settings.modal.include_matching_tags_help"))),m("div",{className:"Form-group"},m("label",null,e().translator.trans("dingtalk-webhook.admin.settings.modal.message_template_label")),m("textarea",{className:"FormControl",rows:6,bidi:this.messageTemplate,placeholder:e().translator.trans("dingtalk-webhook.admin.settings.modal.message_template_placeholder")}),m("p",{className:"helpText"},e().translator.trans("dingtalk-webhook.admin.settings.modal.message_template_help"))))},a.toggleEvent=function(t,e){var n=[].concat(this.events());if(e)n.includes(t)||n.push(t);else{var a=n.indexOf(t);a>-1&&n.splice(a,1)}this.events(n)},a.getGroups=function(){return e().store.all("groups").map(function(t){return{id:t.id(),name:t.namePlural()}})},a.getEventGroups=function(){return[{title:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.discussion.title"),events:[{key:"Flarum\\Discussion\\Event\\Started",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.discussion.started")},{key:"Flarum\\Discussion\\Event\\Renamed",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.discussion.renamed")},{key:"Flarum\\Discussion\\Event\\Hidden",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.discussion.hidden")},{key:"Flarum\\Discussion\\Event\\Restored",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.discussion.restored")},{key:"Flarum\\Discussion\\Event\\Deleted",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.discussion.deleted")}]},{title:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.post.title"),events:[{key:"Flarum\\Post\\Event\\Posted",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.post.posted")},{key:"Flarum\\Post\\Event\\Revised",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.post.revised")},{key:"Flarum\\Post\\Event\\Hidden",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.post.hidden")},{key:"Flarum\\Post\\Event\\Restored",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.post.restored")},{key:"Flarum\\Post\\Event\\Deleted",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.post.deleted")}]},{title:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.user.title"),events:[{key:"Flarum\\User\\Event\\Registered",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.user.registered")},{key:"Flarum\\User\\Event\\Renamed",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.user.renamed")},{key:"Flarum\\User\\Event\\Deleted",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.user.deleted")}]},{title:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.group.title"),events:[{key:"Flarum\\Group\\Event\\Created",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.group.created")},{key:"Flarum\\Group\\Event\\Renamed",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.group.renamed")},{key:"Flarum\\Group\\Event\\Deleted",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.group.deleted")}]},{title:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.approval.title"),events:[{key:"Flarum\\Approval\\Event\\PostWasApproved",label:e().translator.trans("dingtalk-webhook.admin.settings.actions.flarum.approval.postwasapproved")}]}]},a.save=function(){var t=u(c().mark(function t(){var n,a;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.saving=!0,m.redraw(),t.prev=1,n={name:this.name(),url:this.url(),events:this.events(),groupId:this.groupId(),extraText:this.extraText(),maxPostContentLength:this.maxPostContentLength(),usePlainText:this.usePlainText(),includeTags:this.includeTags(),messageTemplate:this.messageTemplate()},this.secret()&&(n.secret=this.secret()),!this.attrs.webhook){t.next=3;break}return t.next=2,this.attrs.webhook.save(n);case 2:t.next=4;break;case 3:return t.next=4,e().store.createRecord("dingtalk-webhooks").save(n);case 4:this.attrs.onSave(),this.hide(),t.next=6;break;case 5:t.prev=5,a=t.catch(1),console.error("Failed to save webhook:",a);case 6:this.saving=!1,m.redraw();case 7:case"end":return t.stop()}},t,this,[[1,5]])}));return function(){return t.apply(this,arguments)}}(),n}(T()),S=function(t){function n(){for(var e,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))||this).webhooks=[],e.loading=!0,e}o(n,t);var a=n.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e),this.loadWebhooks()},a.loadWebhooks=function(){var t=u(c().mark(function t(){var n,a;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,m.redraw(),t.prev=1,t.next=2,e().store.find("dingtalk-webhooks");case 2:n=t.sent,this.webhooks=n,t.next=4;break;case 3:t.prev=3,a=t.catch(1),console.error("Failed to load webhooks:",a),this.webhooks=[];case 4:this.loading=!1,m.redraw();case 5:case"end":return t.stop()}},t,this,[[1,3]])}));return function(){return t.apply(this,arguments)}}(),a.content=function(){var t=this;return m("div",{className:"DingTalkWebhookPage"},m("div",{className:"DingTalkWebhookPage-header"},m("div",{className:"container"},m("p",{className:"DingTalkWebhookPage-description"},e().translator.trans("dingtalk-webhook.admin.settings.help.general")))),m("div",{className:"DingTalkWebhookPage-content"},m("div",{className:"container"},this.loading?m(v(),null):m("div",{className:"DingTalkWebhookPage-webhooks"},0===this.webhooks.length?m("div",{className:"DingTalkWebhookPage-empty"},m("p",null,e().translator.trans("dingtalk-webhook.admin.settings.no_webhooks"))):m("div",{className:"WebhookCards"},this.webhooks.map(function(e){return m(_,{key:e.id(),webhook:e,onEdit:function(){return t.editWebhook(e)},onDelete:function(){return t.deleteWebhook(e)},onTest:function(){return t.testWebhook(e)}})})),m("div",{className:"DingTalkWebhookPage-actions"},m(b(),{className:"Button Button--primary",icon:"fas fa-plus",onclick:function(){return t.addWebhook()}},e().translator.trans("dingtalk-webhook.admin.settings.add_button")))))))},a.addWebhook=function(){var t=this;e().modal.show(C,{webhook:null,onSave:function(){return t.loadWebhooks()}})},a.editWebhook=function(t){var n=this;e().modal.show(C,{webhook:t,onSave:function(){return n.loadWebhooks()}})},a.deleteWebhook=function(){var t=u(c().mark(function t(n){var a;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(confirm(e().translator.trans("dingtalk-webhook.admin.settings.card.delete_confirm"))){t.next=1;break}return t.abrupt("return");case 1:return t.prev=1,t.next=2,n.delete();case 2:this.webhooks=this.webhooks.filter(function(t){return t.id()!==n.id()}),m.redraw(),t.next=4;break;case 3:t.prev=3,a=t.catch(1),console.error("Failed to delete webhook:",a);case 4:case"end":return t.stop()}},t,this,[[1,3]])}));return function(e){return t.apply(this,arguments)}}(),a.testWebhook=function(){var t=u(c().mark(function t(n){var a,o,r,s;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=1,e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/dingtalk-webhooks/"+n.id()+"/test"});case 1:(a=t.sent).success?e().alerts.show({type:"success"},a.message||e().translator.trans("dingtalk-webhook.admin.settings.card.test_success")):e().alerts.show({type:"error"},a.message||e().translator.trans("dingtalk-webhook.admin.settings.card.test_failed")),t.next=3;break;case 2:t.prev=2,s=t.catch(0),r=(null==(o=s.response)?void 0:o.message)||s.message||e().translator.trans("dingtalk-webhook.admin.settings.card.test_failed"),e().alerts.show({type:"error"},r);case 3:case"end":return t.stop()}},t,null,[[0,2]])}));return function(e){return t.apply(this,arguments)}}(),n}(p());e().initializers.add("jiushutech-dingtalk-webhook",function(){e().store.models["dingtalk-webhooks"]=i,e().extensionData.for("jiushutech-dingtalk-webhook").registerPage(S)})})(),module.exports={}})();
//# sourceMappingURL=admin.js.map