# Flarum é’‰é’‰æœºå™¨äºº Webhook æ’ä»¶

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Version](https://img.shields.io/badge/version-1.0.0-green.svg)](https://github.com/jiushutech/flarum-dingtalk-webhook)
[![Flarum](https://img.shields.io/badge/flarum-%5E1.7.0-orange.svg)](https://flarum.org)

å°† Flarum è®ºå›äº‹ä»¶æ¨é€åˆ°é’‰é’‰ç¾¤æœºå™¨äººï¼Œå®ç°ç¤¾åŒºåŠ¨æ€çš„å®æ—¶é€šçŸ¥ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”” **å¤šäº‹ä»¶æ”¯æŒ**ï¼šæ”¯æŒä¸»é¢˜ã€å›å¤ã€ç”¨æˆ·ã€ç”¨æˆ·ç»„ç­‰å¤šç§äº‹ä»¶ç±»å‹
- ğŸ“ **Markdown æ ¼å¼**ï¼šæ¨é€æ¶ˆæ¯é‡‡ç”¨é’‰é’‰ Markdown æ ¼å¼ï¼Œæ’ç‰ˆæ¸…æ™°
- ğŸ” **åŠ ç­¾å®‰å…¨**ï¼šæ”¯æŒé’‰é’‰æœºå™¨äººåŠ ç­¾å®‰å…¨éªŒè¯
- ğŸ·ï¸ **æ ‡ç­¾è¿‡æ»¤**ï¼šå¯é™åˆ¶ Webhook åªåœ¨ç‰¹å®šæ ‡ç­¾ä¸‹è§¦å‘
- ğŸ‘¥ **ç»„ç¾¤æƒé™**ï¼šå¯é…ç½®åªæ¨é€ç‰¹å®šç»„ç¾¤å¯è§çš„å†…å®¹
- ğŸ¨ **å¡ç‰‡å¼ç®¡ç†**ï¼šåå°é‡‡ç”¨å¡ç‰‡å¼ç•Œé¢ï¼Œé…ç½®ç›´è§‚ä¾¿æ·
- âœï¸ **è‡ªå®šä¹‰æ¨¡æ¿**ï¼šæ”¯æŒè‡ªå®šä¹‰æ¶ˆæ¯æ¨¡æ¿ï¼Œçµæ´»æ§åˆ¶æ¨é€æ ¼å¼
- ğŸŒ **ä¸­æ–‡æ”¯æŒ**ï¼šå®Œæ•´çš„ä¸­æ–‡ç•Œé¢å’Œæ¨é€æ¶ˆæ¯

## å®‰è£…

ä½¿ç”¨ Composer å®‰è£…ï¼š

```bash
composer require jiushutech/flarum-dingtalk-webhook
```

## é’‰é’‰æœºå™¨äººé…ç½®

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé’‰é’‰ç¾¤æœºå™¨äºº

1. æ‰“å¼€é’‰é’‰ï¼Œè¿›å…¥éœ€è¦æ¥æ”¶é€šçŸ¥çš„ç¾¤èŠ
2. ç‚¹å‡»ç¾¤è®¾ç½®ï¼ˆå³ä¸Šè§’ `...`ï¼‰â†’ **æ™ºèƒ½ç¾¤åŠ©æ‰‹** â†’ **æ·»åŠ æœºå™¨äºº**
3. é€‰æ‹© **è‡ªå®šä¹‰** æœºå™¨äºº
4. è®¾ç½®æœºå™¨äººåç§°ï¼ˆå¦‚ï¼šè®ºå›é€šçŸ¥ï¼‰å’Œå¤´åƒ

### ç¬¬äºŒæ­¥ï¼šé…ç½®å®‰å…¨è®¾ç½®

é’‰é’‰æœºå™¨äººæ”¯æŒä¸‰ç§å®‰å…¨è®¾ç½®æ–¹å¼ï¼Œ**æ¨èä½¿ç”¨"åŠ ç­¾"æ–¹å¼**ï¼š

#### æ–¹å¼ä¸€ï¼šåŠ ç­¾ï¼ˆæ¨èï¼‰âœ…

1. åœ¨å®‰å…¨è®¾ç½®ä¸­å‹¾é€‰ **åŠ ç­¾**
2. ç³»ç»Ÿä¼šç”Ÿæˆä¸€ä¸ªä»¥ `SEC` å¼€å¤´çš„å¯†é’¥ï¼Œå¦‚ï¼š`SECxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`
3. **å¤åˆ¶å¹¶ä¿å­˜æ­¤å¯†é’¥**ï¼Œç¨åéœ€è¦åœ¨ Flarum åå°é…ç½®

#### æ–¹å¼äºŒï¼šè‡ªå®šä¹‰å…³é”®è¯

1. å‹¾é€‰ **è‡ªå®šä¹‰å…³é”®è¯**
2. è®¾ç½®å…³é”®è¯ï¼ˆå¦‚ï¼š`è®ºå›`ã€`é€šçŸ¥`ï¼‰
3. å‘é€çš„æ¶ˆæ¯å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå…³é”®è¯æ‰èƒ½å‘é€æˆåŠŸ

#### æ–¹å¼ä¸‰ï¼šIP åœ°å€ï¼ˆæ®µï¼‰

1. å‹¾é€‰ **IP åœ°å€ï¼ˆæ®µï¼‰**
2. å¡«å†™æœåŠ¡å™¨çš„å…¬ç½‘ IP åœ°å€
3. åªæœ‰æ¥è‡ªæŒ‡å®š IP çš„è¯·æ±‚æ‰ä¼šè¢«æ¥å—

### ç¬¬ä¸‰æ­¥ï¼šè·å– Webhook åœ°å€

1. å®Œæˆå®‰å…¨è®¾ç½®åï¼Œç‚¹å‡» **å®Œæˆ**
2. ç³»ç»Ÿä¼šæ˜¾ç¤º Webhook åœ°å€ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
   ```
   https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```
3. **å¤åˆ¶å¹¶ä¿å­˜æ­¤åœ°å€**

### ç¬¬å››æ­¥ï¼šåœ¨ Flarum åå°é…ç½®

1. ç™»å½• Flarum ç®¡ç†åå°
2. åœ¨å·¦ä¾§èœå•æ‰¾åˆ° **é’‰é’‰ Webhook** æ‰©å±•
3. ç‚¹å‡» **æ·»åŠ  Webhook** æŒ‰é’®
4. å¡«å†™é…ç½®ä¿¡æ¯ï¼š

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| **åç§°** | Webhook çš„æ˜¾ç¤ºåç§°ï¼Œä¾¿äºè¯†åˆ« |
| **Webhook åœ°å€** | ç²˜è´´ä»é’‰é’‰è·å–çš„ Webhook URL |
| **åŠ ç­¾å¯†é’¥** | å¦‚æœä½¿ç”¨åŠ ç­¾å®‰å…¨è®¾ç½®ï¼Œå¡«å†™ `SEC` å¼€å¤´çš„å¯†é’¥ |
| **äº‹ä»¶** | é€‰æ‹©è¦è§¦å‘æ¨é€çš„äº‹ä»¶ç±»å‹ |
| **æ ‡ç­¾è¿‡æ»¤** | å¯é€‰ï¼Œé™åˆ¶åªåœ¨ç‰¹å®šæ ‡ç­¾ä¸‹è§¦å‘ |
| **ç”¨æˆ·ç»„è¿‡æ»¤** | å¯é€‰ï¼Œé™åˆ¶åªæ¨é€ç‰¹å®šç”¨æˆ·ç»„å¯è§çš„å†…å®¹ |

5. ç‚¹å‡» **ä¿å­˜** å®Œæˆé…ç½®
6. å¯ç‚¹å‡» **æµ‹è¯•å‘é€** éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®

## æ”¯æŒçš„äº‹ä»¶

| åˆ†ç±» | äº‹ä»¶ | è¯´æ˜ |
|------|------|------|
| **ä¸»é¢˜** | discussion.started | æ–°å¸–å‘å¸ƒ |
| | discussion.renamed | ä¸»é¢˜é‡å‘½å |
| | discussion.hidden | ä¸»é¢˜éšè— |
| | discussion.restored | ä¸»é¢˜æ¢å¤ |
| | discussion.deleted | ä¸»é¢˜åˆ é™¤ |
| **å›å¤** | post.posted | æ–°å›å¤ |
| | post.revised | å›å¤ç¼–è¾‘ |
| | post.hidden | å›å¤éšè— |
| | post.restored | å›å¤æ¢å¤ |
| | post.deleted | å›å¤åˆ é™¤ |
| | post.approved | å›å¤å®¡æ ¸é€šè¿‡ï¼ˆéœ€å®‰è£… flarum/approvalï¼‰ |
| **ç”¨æˆ·** | user.registered | ç”¨æˆ·æ³¨å†Œ |
| | user.renamed | ç”¨æˆ·æ”¹å |
| | user.deleted | ç”¨æˆ·åˆ é™¤ |
| **ç”¨æˆ·ç»„** | group.created | ç”¨æˆ·ç»„åˆ›å»º |
| | group.renamed | ç”¨æˆ·ç»„é‡å‘½å |
| | group.deleted | ç”¨æˆ·ç»„åˆ é™¤ |

## è‡ªå®šä¹‰æ¶ˆæ¯æ¨¡æ¿

### å¯ç”¨å˜é‡

| å˜é‡ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|------|------|--------|
| `{title}` | æ¶ˆæ¯æ ‡é¢˜ | `ã€æ–°å¸–å‘å¸ƒã€‘æŠ€æœ¯è®¨è®ºåŒº` |
| `{url}` | èµ„æºé“¾æ¥ | `https://forum.example.com/d/123` |
| `{description}` | å†…å®¹æè¿° | `è¿™æ˜¯å¸–å­çš„æ­£æ–‡å†…å®¹...` |
| `{author}` | æ“ä½œäººåç§° | `å¼ ä¸‰` |
| `{author_url}` | æ“ä½œäººä¸»é¡µ | `https://forum.example.com/u/zhangsan` |
| `{timestamp}` | äº‹ä»¶æ—¶é—´ | `2026-02-01 20:00:00` |
| `{extra_text}` | é™„åŠ æ–‡æœ¬ | `æ¥è‡ªæŠ€æœ¯è®ºå›çš„é€šçŸ¥` |
| `{tags}` | ç›¸å…³æ ‡ç­¾ | `æŠ€æœ¯, è®¨è®º, å…¬å‘Š` |
| `{event_type}` | äº‹ä»¶ç±»å‹ | `discussion.started` |

### æ¨¡æ¿ç¤ºä¾‹

#### ç®€æ´é€šçŸ¥æ¨¡æ¿

```markdown
### {title}

**æ“ä½œäºº**: [{author}]({author_url})
**æ—¶é—´**: {timestamp}

{description}

[ğŸ‘‰ ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…]({url})
```

#### è¯¦ç»†ä¿¡æ¯æ¨¡æ¿

```markdown
## ğŸ“¢ è®ºå›åŠ¨æ€é€šçŸ¥

### {title}

- ğŸ‘¤ æ“ä½œäºº: [{author}]({author_url})
- ğŸ• æ—¶é—´: {timestamp}
- ğŸ·ï¸ æ ‡ç­¾: {tags}

**å†…å®¹æ‘˜è¦**:
> {description}

[ğŸ”— æŸ¥çœ‹åŸæ–‡]({url})

{extra_text}
```

#### æç®€æ¨¡æ¿

```markdown
**{title}**

{description}

[æŸ¥çœ‹è¯¦æƒ…]({url}) | {author} | {timestamp}
```

### é»˜è®¤æ¨¡æ¿

å¦‚æœä¸è®¾ç½®è‡ªå®šä¹‰æ¨¡æ¿ï¼Œç³»ç»Ÿå°†ä½¿ç”¨ä»¥ä¸‹é»˜è®¤æ ¼å¼ï¼š

```markdown
### {title}

**æ“ä½œäºº**: [{author}]({author_url})

**æ—¶é—´**: {timestamp}

**å†…å®¹**: {description}

**æ ‡ç­¾**: {tags}

> {extra_text}

[æŸ¥çœ‹è¯¦æƒ…]({url})
```

## æ¨é€æ¶ˆæ¯ç¤ºä¾‹

```markdown
### ã€æ–°å¸–å‘å¸ƒã€‘Flarum æ’ä»¶å¼€å‘è¿›åº¦æ±‡æŠ¥

**æ“ä½œäºº**: [admin](https://your-forum.com/u/admin)

**æ—¶é—´**: 2026-01-21 15:30:00

**å†…å®¹**: æœ¬æ¬¡å°†å¼€å‘é’‰é’‰æœºå™¨äººé›†æˆæ’ä»¶ï¼Œæ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ Webhook æ¥å…¥ã€äº‹ä»¶æ¨é€...

[æŸ¥çœ‹è¯¦æƒ…](https://your-forum.com/d/123)
```

## å¼€å‘

### å‰ç«¯æ„å»º

```bash
cd js
npm install
npm run dev    # å¼€å‘æ¨¡å¼
npm run build  # ç”Ÿäº§æ„å»º
```

### ç›®å½•ç»“æ„

```
flarum-dingtalk-webhook/
â”œâ”€â”€ composer.json
â”œâ”€â”€ extend.php
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ js/                          # å‰ç«¯ä»£ç 
â”‚   â””â”€â”€ src/admin/
â”‚       â”œâ”€â”€ components/          # React ç»„ä»¶
â”‚       â””â”€â”€ models/              # æ•°æ®æ¨¡å‹
â”œâ”€â”€ migrations/                  # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ resources/
â”‚   â”œâ”€â”€ less/                    # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ locale/                  # è¯­è¨€åŒ…
â””â”€â”€ src/                         # PHP åç«¯ä»£ç 
    â”œâ”€â”€ Actions/                 # äº‹ä»¶å¤„ç†å™¨
    â”œâ”€â”€ Adapters/                # é’‰é’‰é€‚é…å™¨
    â”œâ”€â”€ Api/                     # API æ§åˆ¶å™¨
    â”œâ”€â”€ Helpers/                 # è¾…åŠ©ç±»
    â”œâ”€â”€ Jobs/                    # é˜Ÿåˆ—ä»»åŠ¡
    â”œâ”€â”€ Listener/                # äº‹ä»¶ç›‘å¬å™¨
    â””â”€â”€ Models/                  # æ•°æ®æ¨¡å‹
```

## å¸¸è§é—®é¢˜

### Q: æ¶ˆæ¯å‘é€å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

1. æ£€æŸ¥ Webhook åœ°å€æ˜¯å¦æ­£ç¡®
2. å¦‚æœä½¿ç”¨åŠ ç­¾ï¼Œç¡®è®¤å¯†é’¥æ˜¯å¦æ­£ç¡®
3. å¦‚æœä½¿ç”¨å…³é”®è¯ï¼Œç¡®è®¤æ¶ˆæ¯å†…å®¹åŒ…å«å…³é”®è¯
4. æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦èƒ½è®¿é—®é’‰é’‰ APIï¼ˆ`oapi.dingtalk.com`ï¼‰

### Q: å¦‚ä½•æµ‹è¯•é…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ

åœ¨ Webhook å¡ç‰‡ä¸Šç‚¹å‡»"æµ‹è¯•å‘é€"æŒ‰é’®ï¼Œä¼šå‘é€ä¸€æ¡æµ‹è¯•æ¶ˆæ¯åˆ°é’‰é’‰ç¾¤ã€‚

### Q: ä¸ºä»€ä¹ˆæŸäº›äº‹ä»¶æ²¡æœ‰è§¦å‘ï¼Ÿ

1. æ£€æŸ¥æ˜¯å¦å‹¾é€‰äº†å¯¹åº”çš„äº‹ä»¶ç±»å‹
2. æ£€æŸ¥æ ‡ç­¾è¿‡æ»¤è®¾ç½®æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥ç”¨æˆ·ç»„æƒé™è®¾ç½®

## è®¸å¯è¯

MIT License

## ä½œè€…

[JiushuTech](https://github.com/jiushutech)

## é“¾æ¥

- [GitHub ä»“åº“](https://github.com/jiushutech/flarum-dingtalk-webhook)
- [é—®é¢˜åé¦ˆ](https://github.com/jiushutech/flarum-dingtalk-webhook/issues)
